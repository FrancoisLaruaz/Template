@model Models.ViewModels.HeaderViewModel
@using Microsoft.AspNet.Identity

<header class="sub-nav">
    @Html.Hidden("CentralGoToUrl")
    <nav class="navbar navbar-default navigation" id="homeNavDefault">
        @Html.Partial("~/Views/Shared/Layout/_BrowserBanner.cshtml")
        <div class="container-fluid">
            <div class="navbar-header">
                <button  type="button" class="navbar-toggle collapsed burger" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/"  id="Logo">
                    <img class="brand-logoNav" src="~/Ressources/Files/Images/Logo.png" />
                </a>
            </div>
            <div class="collapse navbar-collapse navigationLink" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right" id="ulForHomeControl">

                    @if(Request.IsAuthenticated && User.IsInRole(CommonsConst.UserRoles.Admin))
                    {
                        <li class="dropdown">
                            <a class="dropdown-toggle navMenuItem" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">[[[Admin]]]</a>
                            <ul class="dropdown-menu noPaddingVertical">
                                <li><a class="NavMenuItemDDL" href="/Admin/Logs">[[[Logs]]]</a></li>
                                <li><a class="NavMenuItemDDL" href="/Admin/EmailAudits">[[[Email Audits]]]</a></li>
                                <li><a class="NavMenuItemDDL" href="/Admin/News">[[[News]]]</a></li>
                                <li><a class="NavMenuItemDDL" href="/Admin/Tasks">[[[Tasks]]]</a></li>
                                <li><a class="NavMenuItemDDL" href="/Admin/Users">[[[Users]]]</a></li>
                            </ul>
                        </li>
                    }

                    @if (CommonsConst.Const.UserManagement)
                    {
                        if (Request.IsAuthenticated)
                        {
                            <li class="dropdown marginLeftHeader">
                                <a href="/User/Index" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    <img src="@Model.PictureThumbnailSrc" id="UserPic" class="UserPic" />
                                @Model.UserFirstName 
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="/Account">[[[My Account]]]</a></li>
                                    @using (Ajax.BeginForm("LogOff", "Account", new { }, new AjaxOptions() { HttpMethod = "POST", OnBegin = "LogOffBegin", OnSuccess = "LogOffSuccess", OnFailure = "LogOffFailure" }, new { @id = "logoutForm", @class = "navbar-right" }))
                                    {
                                        @Html.AntiForgeryToken()
                                    }
                                    <li><a href="/ChangePassword">[[[Change Password]]]</a></li>
                                    <li><a id="LinkLogOff">[[[Log Off]]]</a></li>
                                </ul>
                            </li>
                        }
                        else
                        {
                            @Html.Partial("~/Views/Account/_LoginOrSignInModal.cshtml")
                            //reason: only when the page is NOT the old login/sign up pages, then we render v2 login modal. Otherwise, the login page and the login modal partial will use AccountController and AccountV2Controller, BOTH  of which depend on UserManager. The AccountController disposes of the UserManager object before AccountV2Controller could use it. Error msg is like `...use of a disposed object...`
                        }
                    }
                </ul>
            </div>
        </div>
    </nav>
</header>


<link href="~/Content/Views/Shared/_Header.css" rel="stylesheet" />
<script src="~/Scripts/Views/Shared/_Header.js"></script>