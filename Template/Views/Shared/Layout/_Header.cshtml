@model Models.ViewModels.HeaderViewModel
@using Microsoft.AspNet.Identity

<header class="sub-nav">
    @Html.Hidden("CentralGoToUrl")
    <nav class="navbar navbar-default navigation" id="homeNavDefault">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">
                    <img class="brand-logoNav" src="~/Ressources/Files/Images/Logo.png" />
                </a>
            </div>
            <div class="collapse navbar-collapse navigationLink" id="bs-example-navbar-collapse-1">

                <ul class="nav navbar-nav navbar-right" id="ulForHomeControl">
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">[[[Menu]]]</a>
                        <ul class="dropdown-menu">
                            <li><a href="">1</a></li>
                            <li><a href="">2</a></li>
                            <li><a href="">3</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">[[[Admin]]]</a>
                        <ul class="dropdown-menu">
                            <li><a href="/Admin/Logs">[[[Logs]]]</a></li>
                            <li><a href="/Admin/EmailAudits">[[[Email Audits]]]</a></li>
                            <li><a href="/Admin/Tasks">[[[Tasks]]]</a></li>
                        </ul>
                    </li>

                    
                    @if (Commons.Const.UserManagement)
                    {
                        if (Request.IsAuthenticated)
                        {
                            <li class="dropdown">
                                <a href="/User/Index" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">@Model.UserFirstName<span class="glyphicon glyphicon-user user-icon-span"></span></a>
                                <ul class="dropdown-menu">
                                    <li><a href="/Account">@User.Identity.GetUserName()</a></li>

                                    @if (User.IsInRole("Admin"))
                                    {
                                        <li><a href="/Admin">[[[Admin Panel]]]</a></li>
                                    }
                                    @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
                                    {
                                        @Html.AntiForgeryToken()
                                    }
                                    <li><a href="/Account/Manage">[[[Change Password]]]</a></li>
                                    <li><a href="javascript:document.getElementById('logoutForm').submit()">[[[Log Off]]]</a></li>
                                </ul>
                            </li>
                        }
                        else
                        {
                            <li class="dropdown">
                                <a href="/Login" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">[[[Login]]]</a>
                            </li>
                            @Html.Partial("~/Views/Account/_LoginOrSignInModal.cshtml")
                            //reason: only when the page is NOT the old login/sign up pages, then we render v2 login modal. Otherwise, the login page and the login modal partial will use AccountController and AccountV2Controller, BOTH  of which depend on UserManager. The AccountController disposes of the UserManager object before AccountV2Controller could use it. Error msg is like `...use of a disposed object...`
                        }
                    }
                </ul>
            </div>
        </div>
    </nav>
</header>


<link href="~/Content/Views/Shared/_Header.css" rel="stylesheet" />
<script src="~/Scripts/Views/Shared/_Header.js"></script>